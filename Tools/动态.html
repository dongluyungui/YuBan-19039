<!DOCTYPE html>
<html>

<head>
    <title>Bç«™åŠ¨æ€è§£æ</title>
    <link rel="stylesheet" href="../css/styles.css">
    <meta charset="UTF-8">
    <style>
        body {
            max-width: 800px;
            margin: 20px auto;
            padding: 20px;
        }

        #input {
            width: 100%;
            height: 200px;
            margin-bottom: 10px;
        }

        #output {
            width: 100%;
            height: 300px;
            margin-top: 10px;
            padding: 10px;
            border: 1px solid #ccc;
            white-space: pre-wrap;
            font-family: monospace;
        }

        button {
            margin: 5px 0;
        }
    </style>
</head>

<body>
    <textarea id="input" placeholder="è¯·ç²˜è´´JSONæ•°æ®"></textarea>
    <button onclick="processData()">è§£ææ•°æ®</button>
    <button id="copy-button" onclick="copyOutput()">å¤åˆ¶ä»£ç </button>
    <button id="open-button" onclick="openUrl()">æ‰“å¼€é“¾æ¥</button>
    <textarea id="output" readonly placeholder="ç”Ÿæˆçš„HTMLä»£ç å°†æ˜¾ç¤ºåœ¨æ­¤å¤„"></textarea>

    <script>
        function processData() {
            const input = document.getElementById('input').value;
            const outputArea = document.getElementById('output');

            try {
                const data = JSON.parse(input);
                const items = data.data.items;
                const results = [];

                items.forEach(item => {
                    const modules = item.modules;
                    const result = {
                        å‘å¸ƒæ—¶é—´: modules.module_author.pub_time,
                        åŠ¨æ€å†…å®¹: '',
                        ç±»å‹: '',
                        è§†é¢‘é“¾æ¥: '',
                        è§†é¢‘æ ‡é¢˜: '',
                        id_str: item.id_str
                    };

                    // å¤„ç†æ–‡å­—åŠ¨æ€
                    if (modules.module_dynamic.desc) {
                        result.åŠ¨æ€å†…å®¹ = modules.module_dynamic.desc.text;
                        result.ç±»å‹ = 'æ–‡å­—åŠ¨æ€';
                    }

                    // å¤„ç†è§†é¢‘æŠ•ç¨¿
                    if (modules.module_dynamic.major?.archive) {
                        const archive = modules.module_dynamic.major.archive;
                        result.åŠ¨æ€å†…å®¹ = archive.desc;
                        result.ç±»å‹ = archive.badge.text;
                        result.è§†é¢‘é“¾æ¥ = `https:${archive.jump_url.replace('//', '')}`;
                        result.è§†é¢‘æ ‡é¢˜ = archive.title;
                    }

                    results.push(result);
                });

                // æŒ‰æ—¶é—´å€’åºæ’åˆ—
                results.sort((a, b) => new Date(b.å‘å¸ƒæ—¶é—´) - new Date(a.å‘å¸ƒæ—¶é—´));

                // æ ¼å¼åŒ–è¾“å‡ºä¸º HTML ä»£ç å­—ç¬¦ä¸²
                let output = '<div id="dynamics-container" class="dynamic-list">';
                results.forEach((item) => {
                    let dynamicContent = '';
                    if (item.ç±»å‹ === 'æ–‡å­—åŠ¨æ€' && item.id_str) {
                        dynamicContent += `<div class="dynamic-content"><a class="source-link" href="https://t.bilibili.com/${item.id_str}" target="_blank">${item.åŠ¨æ€å†…å®¹}</a></div>`;
                    } else {
                        dynamicContent += `<div class="dynamic-content">${item.åŠ¨æ€å†…å®¹}</div>`;
                    }

                    // æ·»åŠ è§†é¢‘é“¾æ¥
                    if (item.è§†é¢‘é“¾æ¥) {
                        dynamicContent += `<div class="dynamic-content"><a class="source-link" href="${item.è§†é¢‘é“¾æ¥}" target="_blank">${item.è§†é¢‘æ ‡é¢˜}</a></div>`;
                    }

                    output += `
    <div class="dynamic-item">
      <div class="dynamic-time">ğŸ“… ${item.å‘å¸ƒæ—¶é—´}</div>
      <div class="dynamic-time">${item.ç±»å‹}</div>
      ${dynamicContent}
    </div>`;
                });
                output += '</div>';

                outputArea.value = output;
            } catch (error) {
                outputArea.value = 'è§£æé”™è¯¯ï¼Œè¯·æ£€æŸ¥JSONæ ¼å¼æ˜¯å¦æ­£ç¡®';
            }
        }

        function copyOutput() {
            const outputArea = document.getElementById('output');
            outputArea.select();
            document.execCommand('copy');
        }
        function openUrl() {
            window.open('https://api.bilibili.com/x/polymer/web-dynamic/v1/feed/space?host_mid=12136555', '_blank');
        }
    </script>
</body>

</html>    