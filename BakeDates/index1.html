<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>å¾¡å‚19039ã®æ¸©é¦¨å°ç«™</title>
    <link rel="stylesheet" href="styles.css">
    <link rel="icon" href="img/favicon.ico" type="image/x-icon">
    <style>
        /* æ–°å¢åŠ¨æ€æ ·å¼ */
        .dynamic-list {
            margin-top: 20px;
        }

        .dynamic-item {
            background: #fff;
            border-radius: 10px;
            padding: 15px;
            margin-bottom: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
        }

        .dynamic-time {
            color: #666;
            font-size: 0.9em;
            margin-bottom: 8px;
        }

        .dynamic-content {
            line-height: 1.6;
        }

        /* é¦–é¡µä¸“å±æ ·å¼ */
        .banner {
            background: linear-gradient(135deg, var(--secondary-color), var(--primary-color));
            border-radius: 20px;
            padding: 30px;
            text-align: center;
            color: white;
            margin-bottom: 40px;
        }

        .profile-card {
            background: white;
            display: flex;
            align-items: center;
            padding: 30px;
            margin: 20px 0;
            position: relative;
            /* æ–°è®©å­å…ƒç´ ç»å¯¹å®šä½ç›¸å¯¹äºæ­¤å…ƒç´  */
        }

        .avatar {
            width: 200px;
            height: 200px;
            border-radius: 50%;
            margin-right: 30px;
            border: 5px solid var(--secondary-color);
        }

        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(250px, 1fr));
            gap: 20px;
            margin: 40px 0;
        }

        .stat-card {
            background-color: white;
            /* å¡ç‰‡èƒŒæ™¯é¢œè‰²ä¸ºç™½è‰² */
            border-radius: 10px;
            /* å¡ç‰‡åœ†è§’ */
            padding: 15px;
            /* å¡ç‰‡å†…è¾¹è· */
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            /* å¡ç‰‡é˜´å½±æ•ˆæœ */
            text-align: center;
            /* å¡ç‰‡å†…æ–‡æœ¬å±…ä¸­æ˜¾ç¤º */
        }

        .stat-number {
            color: var(--primary-color);
            font-size: 2.5em;
            font-weight: bold;
            margin: 10px 0;
        }

        #countdown {
            text-align: right;
            /* æ–‡å­—å³å¯¹é½ */
            font-size: 20px;
            margin-top: 20px;
        }

        /* æ–°å¢æ ·å¼ï¼Œç”¨äºæ˜¾ç¤ºè·ç¦»ä¸€ä¸‡ç²‰ä¸çš„å·®å€¼ */
        #fans-difference {
            text-align: right;
            font-size: 20px;
            margin-top: 10px;
        }

        #debut-time {
            text-align: right;
            font-size: 20px;
            margin-top: 10px;
        }

        /* æ–°å¢èˆ°é•¿ç»Ÿè®¡å¡ç‰‡æ ·å¼ */
        #captain-count {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        #captain-list {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin-top: 20px;
        }

        .captain-card {
            background-color: white;
            border-radius: 10px;
            padding: 15px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
            text-align: center;
        }

        .captain-avatar {
            width: 80px;
            height: 80px;
            border-radius: 50%;
            margin-bottom: 10px;
        }
    </style>
</head>

<body>
    <header class="header">
        <div class="header-content">
            <div>
                <a href="index.html" class="nav-link">é¦–é¡µ</a>
                <a href="About.html" class="nav-link">å…³äº</a>
                <a href="Sound.html" class="nav-link active">è¯­éŸ³æŒ‰é’®</a>
                <a href="LiveHistory.html" class="nav-link">å¾€æœŸå›æ”¾</a>
            </div>
            <div>
                <a href="https://space.bilibili.com/12136555" target="_blank" class="bilibili-btn">ä¸ªäººä¸»é¡µ</a>
                <a href="https://live.bilibili.com/8414339" target="_blank" class="bilibili-btn">è¿›å…¥ç›´æ’­é—´</a>
            </div>
        </div>
    </header>

    <div class="container">
        <div class="banner">
            <h1>âš¡å¾¡å‚19039ã®æ¸©é¦¨å°ç«™âš¡</h1>
            <p>æ¬¢è¿æ¥åˆ°å¾¡å‚19039çš„åº”æ´åŸºåœ°ï¼(â‰§âˆ‡â‰¦)ï¾‰</p>
        </div>

        <div class="profile-card">
            <img src="img/face.webp" alt="å¾¡å‚19039" class="avatar">
            <div>
                <h2 style="color: #e91e63; margin-top: 0;">âœ¨ ä¸»æ’­ä»‹ç» âœ¨</h2>
                <p>ğŸ¤ Bç«™IDï¼šå¾¡å‚19039</p>
                <p>ğŸˆå‡ºé“æ—¥æœŸï¼š2024å¹´5æœˆ27æ—¥</p>
                <p>ğŸŒŸ ç›´æ’­ç±»å‹ï¼šèŠå¤©äº’åŠ¨ | æ¸¸æˆå®å†µ | æ‰è‰ºå±•ç¤º</p>
                <p>ğŸ’– ç›´æ’­æ—¶é—´ï¼šä¸å®šæœŸç›´æ’­å“¦~æ—¶é—´å˜åŠ¨ä¼šå‘åŠ¨æ€å˜Ÿ</p>
                <p>ğŸ“Œ ä¸ªäººæ ‡ç­¾ï¼šå…ƒæ°”æ»¡æ»¡ | è¶…ç”µç£ç‚® | æ²»æ„ˆç³»</p>
                <div style="margin-top: 20px;">
                    <a href="https://space.bilibili.com/12136555/" target="_blank" class="bilibili-btn">ä¸ªäººä¸»é¡µ</a>
                    <a href="https://live.bilibili.com/8414339/" target="_blank" class="bilibili-btn">ç›´æ’­é—´</a>
                </div>
            </div>
            <div style="margin-left: auto;">
                <div id="countdown">ç”Ÿæ—¥å›å€’è®¡æ—¶ï¼šåŠ è½½ä¸­...</div>
                <!-- æ–°å¢å…ƒç´ ï¼Œç”¨äºæ˜¾ç¤ºå·²å‡ºé“æ—¶é—´ -->
                <div id="debut-time">å·²å‡ºé“ï¼šåŠ è½½ä¸­...</div>
                <!-- æ–°å¢å…ƒç´ ï¼Œç”¨äºæ˜¾ç¤ºè·ç¦»ä¸€ä¸‡ç²‰ä¸çš„å·®å€¼ -->
                <div id="fans-difference">è·ç¦»ä¸€ä¸‡ç²‰ä¸è¿˜å·®ï¼šåŠ è½½ä¸­...</div>
            </div>
        </div>

        <div class="stats-grid">
            <div class="stat-card">
                <h3>ç²‰ä¸æ•°é‡</h3>
                <div class="stat-number loading" id="fans-count"></div>
                <p>æŒç»­å¢é•¿ä¸­...</p>
            </div>
            <div class="stat-card">
                <h3>ç›´æ’­é—´äººæ°”</h3>
                <div class="stat-number loading" id="live-popularity"></div>
                <p id="live-status">å½“å‰ç›´æ’­çŠ¶æ€</p>
            </div>
            <!-- æ–°å¢èˆ°é•¿ç»Ÿè®¡å¡ç‰‡ -->
            <div class="stat-card" id="captain-count">
                <h3>èˆ°é•¿æ•°é‡</h3>
                <div class="stat-number loading" id="captain-number"></div>
                <p>æ„Ÿè°¢èˆ°é•¿ä»¬çš„æ”¯æŒï¼</p>
            </div>
        </div>

        <h1>èˆ°é•¿åˆ—è¡¨</h1>
        <div id="captain-list"></div>

        <!-- é¡µè„š -->
        <div style="text-align: center; padding: 30px; color: #666;">
            <p>Â© 2024 å¾¡å‚19039 åº”æ´ç«™ | ç²‰ä¸ç¾¤ï¼š769271000</p>
            <p>æœ¬ç«™ä¸ºç²‰ä¸è‡ªåˆ¶ï¼Œä¸å“”å“©å“”å“©å®˜æ–¹æ— å…³</p>
        </div>

    </div>

    <script>
        // é…ç½®ä¿¡æ¯
        const CONFIG = {
            UID: 12136555,
            ROOM_ID: 8414339,
            CORS_PROXY: 'https://api.allorigins.win/get?url=', // å¤‡ç”¨ä»£ç†
            REFRESH_INTERVAL: 300000, // 5åˆ†é’Ÿåˆ·æ–°
            PAGE_SIZE: 10
        };

        // å…ƒç´ å¼•ç”¨
        const elements = {
            fans: document.getElementById('fans-count'),
            popularity: document.getElementById('live-popularity'),
            liveStatus: document.getElementById('live-status'),
            // æ–°å¢å…ƒç´ å¼•ç”¨
            fansDifference: document.getElementById('fans-difference'),
            debutTime: document.getElementById('debut-time'),
            captain: document.getElementById('captain-number')
        };

        // é€šç”¨è¯·æ±‚æ–¹æ³•
        async function fetchData(url) {
            try {
                const response = await fetch(`${CONFIG.CORS_PROXY}${encodeURIComponent(url)}`);
                if (!response.ok) throw new Error('ç½‘ç»œè¯·æ±‚å¤±è´¥');

                const data = await response.json();
                return JSON.parse(data.contents);
            } catch (error) {
                console.error('æ•°æ®è·å–å¤±è´¥:', error);
                return null;
            }
        }

        // æ›´æ–°ç»Ÿè®¡æ•°æ®
        function updateStat(element, value, suffix = '') {
            element.classList.remove('loading');
            if (value === null) {
                element.textContent = 'æ•°æ®æš‚ä¸å¯ç”¨';
                element.style.color = '#999';
            } else {
                let displayValue;
                if (value >= 10000) {
                    displayValue = `${(value / 10000).toFixed(1)}ä¸‡${suffix}`;
                } else {
                    displayValue = `${value}${suffix}`;
                }
                element.textContent = displayValue;
                element.style.color = '#e91e63';
            }
        }

        // åŠ è½½æ‰€æœ‰æ•°æ®
        async function loadAllData() {
            // ç²‰ä¸æ•°æ®
            const fansData = await fetchData(
                `https://api.bilibili.com/x/relation/stat?vmid=${CONFIG.UID}`
            );
            const followerCount = fansData?.data?.follower;
            updateStat(elements.fans, followerCount);

            // è®¡ç®—è·ç¦»ä¸€ä¸‡ç²‰ä¸çš„å·®å€¼
            if (followerCount!== null) {
                const difference = 10000 - followerCount;
                if (difference > 0) {
                    elements.fansDifference.textContent = `è·ç¦»ä¸€ä¸‡ç²‰ä¸è¿˜å·®ï¼š${difference} ç²‰ä¸`;
                } else {
                    elements.fansDifference.textContent = 'å·²è¾¾åˆ°ä¸€ä¸‡ç²‰ä¸ï¼';
                }
            } else {
                elements.fansDifference.textContent = 'æ•°æ®æš‚ä¸å¯ç”¨';
            }

            // ç›´æ’­é—´æ•°æ®
            const liveData = await fetchData(
                `https://api.live.bilibili.com/room/v1/Room/get_info?room_id=${CONFIG.ROOM_ID}`
            );
            updateStat(elements.popularity, liveData?.data?.online);
            elements.liveStatus.textContent = liveData?.data?.live_status === 1
               ? 'ğŸ”´ æ­£åœ¨ç›´æ’­ä¸­'
                : 'âšªï¸ å½“å‰æœªå¼€æ’­';

            // èˆ°é•¿æ•°æ®
            const captainData = await fetchData(
                `https://api.live.bilibili.com/xlive/app-room/v2/guardTab/topList?roomid=${CONFIG.ROOM_ID}&page=1&ruid=${CONFIG.UID}&page_size=${CONFIG.PAGE_SIZE}`
            );
            const captainCount = captainData?.data?.info?.num || null;
            updateStat(elements.captain, captainCount);
        }

        // æ–°å¢å€’è®¡æ—¶åŠŸèƒ½
        function updateCountdown() {
            const now = new Date();
            // å¯ä»¥ä¿®æ”¹ä¸‹é¢è¿™ä¸€è¡Œæ¥æ”¹å˜ç›®æ ‡æ—¥æœŸï¼Œè¿™é‡Œè®¾ç½®ä¸ºæ¯å¹´çš„5æœˆ27æ—¥
            let targetYear = now.getFullYear();
            const targetDate = new Date(targetYear, 4, 27); // æ³¨æ„ï¼šæœˆä»½æ˜¯ä»0å¼€å§‹è®¡æ•°ï¼Œ4ä»£è¡¨5æœˆ
            if (now > targetDate) {
                targetYear++;
                targetDate.setFullYear(targetYear);
            }
            const timeDiff = targetDate - now;

            if (timeDiff > 0) {
                const days = Math.floor(timeDiff / (1000 * 60 * 60 * 24));
                const hours = Math.floor((timeDiff % (1000 * 60 * 60 * 24)) / (1000 * 60 * 60));
                const minutes = Math.floor((timeDiff % (1000 * 60 * 60)) / (1000 * 60));
                const seconds = Math.floor((timeDiff % (1000 * 60)) / 1000);
                const countdownElement = document.getElementById('countdown');
                // ä¿®æ”¹æ˜¾ç¤ºæ ¼å¼ä¸º â€œç”Ÿæ—¥å›å€’è®¡æ—¶: 58å¤©:3å°æ—¶:50åˆ†:25ç§’â€
                countdownElement.textContent = `ç”Ÿæ—¥å›å€’è®¡æ—¶: ${days}å¤©:${hours}å°æ—¶:${minutes}åˆ†:${seconds}ç§’`;
            } else {
                const countdownElement = document.getElementById('countdown');
                countdownElement.textContent = 'ç”Ÿæ—¥å›å·²åˆ°ï¼';
            }
        }

        // è®¡ç®—å‡ºé“æ—¶é—´
        function calculateDebutTime() {
            const debutDate = new Date(2024, 4, 27); // å‡ºé“æ—¥æœŸï¼Œæ³¨æ„æœˆä»½ä»0å¼€å§‹
            const now = new Date();
            const timeDiff = now - debutDate;

            const totalSeconds = Math.floor(timeDiff / 1000);
            const seconds = totalSeconds % 60;
            const totalMinutes = Math.floor(totalSeconds / 60);
            const minutes = totalMinutes % 60;
            const totalHours = Math.floor(totalMinutes / 60);
            const hours = totalHours % 24;
            const totalDays = Math.floor(totalHours / 24);
            const years = Math.floor(totalDays / 365);
            const remainingDays = totalDays % 365;

            let displayText = '';
            if (years >= 1) {
                displayText = `${years}å¹´${remainingDays}å¤©:${hours}å°æ—¶:${minutes}åˆ†:${seconds}ç§’`;
            } else {
                displayText = `${remainingDays}å¤©:${hours}å°æ—¶:${minutes}åˆ†:${seconds}ç§’`;
            }

            elements.debutTime.textContent = `å·²å‡ºé“ï¼š${displayText}`;
        }

        // å»é™¤ HTML æ ‡ç­¾çš„å‡½æ•°
        function stripHtmlTags(str) {
            return str.replace(/<[^>]*>/g, '');
        }

        // æ¸²æŸ“èˆ°é•¿åˆ—è¡¨
        function renderCaptainList(captains) {
            const captainList = document.getElementById('captain-list');
            captainList.innerHTML = '';
            if (captains && captains.length > 0) {
                captains.forEach(captain => {
                    const card = document.createElement('div');
                    card.classList.add('captain-card');

                    const avatar = document.createElement('img');
                    avatar.classList.add('captain-avatar');
                    // å®¹é”™å¤„ç†ï¼Œå½“ face å­—æ®µä¸å­˜åœ¨æˆ–ä¸ºç©ºæ—¶æ˜¾ç¤ºé»˜è®¤å›¾ç‰‡
                    avatar.src = captain.face || 'default-avatar.png';
                    let displayName = captain.username || 'æœªçŸ¥èˆ°é•¿';
                    displayName = stripHtmlTags(displayName);
                    avatar.alt = displayName;

                    const name = document.createElement('p');
                    name.textContent = displayName;

                    card.appendChild(avatar);
                    card.appendChild(name);
                    captainList.appendChild(card);
                });
            } else {
                const message = document.createElement('p');
                message.textContent = 'æš‚æ— èˆ°é•¿ä¿¡æ¯';
                captainList.appendChild(message);
            }
        }

        // åŠ è½½èˆ°é•¿æ•°æ®
        async function loadCaptainData() {
            const url = `https://api.live.bilibili.com/xlive/app-room/v2/guardTab/topList?roomid=${CONFIG.ROOM_ID}&page=1&ruid=${CONFIG.UID}&page_size=${CONFIG.PAGE_SIZE}`;
            const captainData = await fetchData(url);
            console.log('å¤„ç†åçš„èˆ°é•¿æ•°æ®:', captainData); // æ‰“å°å¤„ç†åçš„èˆ°é•¿æ•°æ®
            if (captainData) {
                // åˆå¹¶ data.list å’Œ data.top3 ä¸­çš„èˆ°é•¿æ•°æ®
                const allCaptains = [
                   ...(captainData.data.list || []),
                   ...(captainData.data.top3 || [])
                ];
                renderCaptainList(allCaptains);
            }
        }

        // åˆå§‹åŒ–å€’è®¡æ—¶
        updateCountdown();
        setInterval(updateCountdown, 1000);

        // åˆå§‹åŒ–å·²å‡ºé“æ—¶é—´æ˜¾ç¤º
        calculateDebutTime();
        setInterval(calculateDebutTime, 1000);

        // åˆå§‹åŒ–
        document.addEventListener('DOMContentLoaded', () => {
            loadAllData();
            setInterval(loadAllData, CONFIG.REFRESH_INTERVAL);
            loadCaptainData();
        });

        // é”™è¯¯å¤„ç†
        window.addEventListener('error', (event) => {
            console.error('å…¨å±€é”™è¯¯:', event.error);
            [elements.fans, elements.popularity, elements.captain].forEach(el => {
                el.textContent = 'æ•°æ®è·å–å¤±è´¥';
                el.style.color = '#ff0000';
            });
        });
    </script>
</body>

</html>